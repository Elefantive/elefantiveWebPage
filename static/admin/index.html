<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Manager â€” Elefantive</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&family=Josefin+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  <script>
    var ProductPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var title = entry.getIn(['data', 'title']) || '';
        var image = entry.getIn(['data', 'image']);
        var price = entry.getIn(['data', 'price']);
        var description = entry.getIn(['data', 'description']) || '';
        var featured = entry.getIn(['data', 'featured']);
        var body = this.props.widgetFor('body');
        var gallery = entry.getIn(['data', 'gallery']);
        var videos = entry.getIn(['data', 'videos']);

        var imgSrc = image ? this.props.getAsset(image).toString() : null;

        // Shared styles
        var s = {
          wrap: { fontFamily: "'Josefin Sans', sans-serif", color: '#231F20', padding: '1.5rem', background: '#f7f8f7', minHeight: '100%' },
          grid: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem', maxWidth: '900px', margin: '0 auto' },
          mainImg: { width: '100%', borderRadius: '8px', boxShadow: '0 4px 16px rgba(0,0,0,0.08)' },
          thumbRow: { display: 'flex', gap: '0.5rem', marginTop: '0.75rem', overflowX: 'auto' },
          thumb: { width: '60px', height: '60px', objectFit: 'cover', borderRadius: '4px', border: '2px solid #d0d5d2' },
          thumbVid: { width: '60px', height: '60px', objectFit: 'cover', borderRadius: '4px', border: '2px solid #2A706C' },
          video: { width: '100%', borderRadius: '8px', marginTop: '0.75rem' },
          h1: { fontFamily: "'Baloo 2', cursive", fontSize: '2rem', fontWeight: 700, marginBottom: '0.5rem', lineHeight: 1.3 },
          price: { fontSize: '1.3rem', fontWeight: 600, color: '#2A706C', marginBottom: '1rem' },
          desc: { color: '#3a3536', fontSize: '1rem', marginBottom: '1rem' },
          body: { lineHeight: 1.8, marginBottom: '1.5rem' },
          btn: { display: 'inline-block', padding: '0.75rem 1.8rem', background: '#2A706C', color: '#fff', borderRadius: '8px', fontWeight: 600, textDecoration: 'none', marginRight: '0.5rem' },
          btnSec: { display: 'inline-block', padding: '0.75rem 1.8rem', background: 'transparent', color: '#2A706C', borderRadius: '8px', fontWeight: 600, textDecoration: 'none', border: '2px solid #2A706C' },
          badge: { display: 'inline-block', background: '#2A706C', color: '#fff', fontSize: '0.75rem', padding: '0.2rem 0.6rem', borderRadius: '3px', marginBottom: '0.75rem' }
        };

        // Build thumbnail list
        var thumbs = [];
        if (imgSrc) {
          thumbs.push(h('img', { key: 'main', src: imgSrc, style: s.thumb }));
        }
        if (gallery && gallery.size > 0) {
          gallery.forEach(function(img, i) {
            thumbs.push(h('img', { key: 'g' + i, src: img, style: s.thumb }));
          });
        }
        if (videos && videos.size > 0) {
          videos.forEach(function(vid, i) {
            thumbs.push(h('div', { key: 'v' + i, style: { position: 'relative', width: '60px', height: '60px', flexShrink: 0 }},
              h('video', { src: vid, style: s.thumbVid, muted: true, preload: 'metadata' }),
              h('span', { style: { position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%,-50%)', color: '#fff', fontSize: '1rem', textShadow: '0 1px 3px rgba(0,0,0,0.5)' }}, '\u25B6')
            ));
          });
        }

        return h('div', { style: s.wrap },
          h('div', { style: s.grid },
            // Left: media
            h('div', {},
              imgSrc ? h('img', { src: imgSrc, style: s.mainImg }) : null,
              thumbs.length > 1 ? h('div', { style: s.thumbRow }, thumbs) : null,
              videos && videos.size > 0 ? videos.map(function(vid, i) {
                return h('video', { key: i, src: vid, controls: true, style: s.video });
              }) : null
            ),
            // Right: info
            h('div', {},
              featured ? h('span', { style: s.badge }, 'Featured') : null,
              h('h1', { style: s.h1 }, title),
              price ? h('p', { style: s.price }, '\u20AC ' + price) : null,
              description ? h('p', { style: s.desc }, description) : null,
              h('div', { style: s.body }, body),
              h('a', { style: s.btn }, 'Order by Email'),
              h('a', { style: s.btnSec }, '\u2190 All Products')
            )
          )
        );
      }
    });

    CMS.registerPreviewTemplate('products', ProductPreview);
  </script>
</body>
</html>
