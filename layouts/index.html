{{ define "main" }}
{{ $home := site.GetPage "/homepage" }}
<section class="hero">
  <div class="container">
    <h1>{{ with $home }}{{ .Params.heroTitle }}{{ else }}{{ site.Params.homeTitle }}{{ end }}</h1>
    <p>{{ with $home }}{{ .Params.heroSubtitle }}{{ else }}{{ site.Params.homeSubtitle }}{{ end }}</p>
    {{ $productsPage := .Site.GetPage "/products" }}
    <a href="{{ $productsPage.RelPermalink }}" class="btn btn-primary">{{ site.Params.browseText }}</a>
  </div>
</section>

<section class="featured-products">
  <div class="container">
    <h2>{{ site.Params.featuredTitle }}</h2>
    <div class="product-grid">
      {{ $products := where .Site.RegularPages "Section" "products" }}
      {{ range first 6 ($products | intersect (where $products ".Params.featured" true)) }}
        {{ partial "product-card.html" . }}
      {{ else }}
        {{/* If no featured products, show first 6 */}}
        {{ range first 6 $products }}
          {{ partial "product-card.html" . }}
        {{ end }}
      {{ end }}
    </div>
    <div class="text-center">
      {{ $productsPage2 := .Site.GetPage "/products" }}
      <a href="{{ $productsPage2.RelPermalink }}" class="btn btn-secondary">{{ site.Params.viewAllText }}</a>
    </div>
  </div>
</section>

{{ with $home }}{{ with .Content }}
<section class="home-content">
  <div class="container">
    {{ . }}
  </div>
</section>
{{ end }}{{ end }}
{{ end }}
